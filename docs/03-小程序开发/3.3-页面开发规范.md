# 3.3 页面开发规范

## 一、文件命名

### 1.1 目录命名
- 全小写
- 短横线分隔
- 英文单词

示例:
- `pages/index/` (首页)
- `pages/order/list/` (订单列表)
- `pages/order/detail/` (订单详情)

---

### 1.2 文件命名

| 类型 | 命名规范 | 示例 |
|------|---------|------|
| 页面 | index.js/wxss/json/wxml | `pages/index/index.js` |
| 组件 | 组件名/index.js/wxss/json/wxml | `components/product-card/index.js` |
| 工具 | 功能.js | `utils/request.js` |

---

## 二、代码风格

### 2.1 缩进
- 使用 2 空格缩进
- 不使用 Tab

```javascript
// 正确
Page({
  data: {
    list: []
  },

  onLoad() {
    this.loadList()
  }
})

// 错误
Page({
	data: {
		list: []
	},

	onLoad() {
		this.loadList()
	}
})
```

---

### 2.2 引号
- 优先使用单引号
- 字符串中包含单引号时使用双引号

```javascript
// 正确
const url = 'http://example.com'
const name = "It's me"

// 错误
const url = "http://example.com"
const name = 'It\'s me'
```

---

### 2.3 分号
- 语句结尾使用分号

```javascript
// 正确
const list = [];
this.setData({ list });

// 错误
const list = []
this.setData({ list })
```

---

### 2.4 变量命名
- 使用驼峰命名法
- 常量使用大写下划线

```javascript
// 正确
const userId = 1;
const MAX_COUNT = 100;

// 错误
const user_id = 1;
const maxCount = 100;
```

---

### 2.5 注释
- 必要时添加注释
- 注释在代码上方

```javascript
// 加载商品列表
loadProducts() {
  wx.request({
    url: 'http://api.mall.com/products',
    success: (res) => {
      this.setData({ products: res.data.data })
    }
  })
}
```

---

## 三、页面结构

### 3.1 标准页面结构

```javascript
// index.js
const app = getApp()
const request = require('../../utils/request')

Page({
  data: {
    // 页面数据
  },

  onLoad(options) {
    // 页面加载
  },

  onReady() {
    // 页面首次渲染完成
  },

  onShow() {
    // 页面显示
  },

  onHide() {
    // 页面隐藏
  },

  onUnload() {
    // 页面卸载
  },

  onPullDownRefresh() {
    // 下拉刷新
  },

  onReachBottom() {
    // 上拉加载更多
  },

  onShareAppMessage() {
    // 分享
  }
})
```

---

### 3.2 模板结构 (wxml)

```html
<!-- 使用 class 而非 id -->
<view class="product-list">
  <view class="product-item" wx:for="{{products}}" wx:key="id">
    <image class="product-image" src="{{item.cover}}" mode="aspectFill"></image>
    <view class="product-info">
      <text class="product-name">{{item.name}}</text>
      <text class="product-price">{{item.price}}</text>
    </view>
  </view>
</view>
```

---

### 3.3 样式结构 (wxss)

```css
/* 使用 class 命名空间 */
.product-list {
  padding: 20rpx;
}

.product-item {
  display: flex;
  margin-bottom: 20rpx;
}

.product-image {
  width: 200rpx;
  height: 200rpx;
}

.product-info {
  flex: 1;
  margin-left: 20rpx;
}

/* 使用变量 */
.product-name {
  font-size: 28rpx;
  color: var(--text-color);
}

.product-price {
  font-size: 32rpx;
  color: var(--primary-color);
  font-weight: bold;
}
```

---

## 四、最佳实践

### 4.1 setData 优化

```javascript
// 正确：只更新需要改变的数据
this.setData({
  'list[0].name': 'New Name'
})

// 错误：更新整个对象
this.setData({
  list: this.data.list
})
```

---

### 4.2 数据绑定

```html
<!-- 正确：使用 {{}} 绑定 -->
<text>{{userName}}</text>

<!-- 错误：不要在属性中使用 {{}} -->
<image src="{{imageSrc}}" />

<!-- 正确：布尔值直接使用 -->
<view wx:if="{{isShow}}">Show</view>
```

---

### 4.3 事件处理

```javascript
// 使用 data-* 传递参数
<view bindtap="handleTap" data-id="{{item.id}}">Click</view>

handleTap(e) {
  const id = e.currentTarget.dataset.id
}
```

---

### 4.4 避免内存泄漏

```javascript
Page({
  onLoad() {
    this.timer = setInterval(() => {
      // 定时任务
    }, 1000)
  },

  onUnload() {
    // 清理定时器
    if (this.timer) {
      clearInterval(this.timer)
    }
  }
})
```

---

## 五、性能优化

### 5.1 避免频繁 setData

```javascript
// 错误：循环中 setData
for (let i = 0; i < 100; i++) {
  this.setData({
    count: i
  })
}

// 正确：批量更新
const updates = {}
for (let i = 0; i < 100; i++) {
  updates[`list[${i}].value`] = i
}
this.setData(updates)
```

---

### 5.2 使用 wx:if 和 hidden

```html
<!-- 元素会频繁切换时使用 hidden -->
<view hidden="{{!isShow}}">Content</view>

<!-- 元素不常切换时使用 wx:if -->
<view wx:if="{{isLoggedIn}}">User Info</view>
```

---

### 5.3 图片懒加载

```html
<image src="{{imageSrc}}" lazy-load="{{true}}" mode="aspectFill"></image>
```

---

### 5.4 分包加载

```json
// app.json
{
  "subpackages": [
    {
      "root": "pages/order/",
      "name": "order",
      "pages": [
        "list/index",
        "detail/index"
      ]
    }
  ]
}
```

---

## 六、安全建议

### 6.1 敏感信息
- 不要在前端存储敏感信息
- 使用 HTTPS 传输
- Token 存储在本地存储中

### 6.2 输入验证
- 验证用户输入
- 防止 XSS 攻击
- 防止 SQL 注入

---

## 七、检查清单

- [ ] 文件命名规范
- [ ] 代码缩进统一
- [ ] 使用单引号
- [ ] 语句结尾加分号
- [ ] 必要时添加注释
- [ ] setData 优化
- [ ] 避免内存泄漏
- [ ] 图片懒加载
- [ ] 敏感信息保护
