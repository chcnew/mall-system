# 2.6 后台管理 API 文档

## 一、概述

本文档描述后台管理系统相关 API 接口，包括商品、订单、用户、营销、系统管理。

**基础 URL**: `http://localhost:8000/api/admin`

---

## 二、认证模块

### 2.1 管理员登录

管理员用户名密码登录，返回 JWT Token。

**接口**: `POST /api/admin/login`

**请求参数**:

```json
{
  "username": "admin",
  "password": "admin123"
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| username | string | 是 | 用户名 |
| password | string | 是 | 密码 |

**响应示例**:

```json
{
  "code": 0,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "admin": {
      "id": 1,
      "username": "admin",
      "nickname": "超级管理员",
      "avatar": "https://...",
      "role": "admin",
      "status": 1
    }
  }
}
```

---

## 三、商品管理模块

### 3.1 获取商品列表

获取商品列表，支持筛选和分页。

**接口**: `GET /api/admin/products`

**认证**: 需要登录（管理员 Token）

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | integer | 否 | 页码，默认 1 |
| size | integer | 否 | 每页数量，默认 20 |
| category_id | integer | 否 | 分类 ID |
| status | integer | 否 | 状态：0全部 1上架 2下架 |
| keyword | string | 否 | 搜索关键词 |

**响应示例**:

```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "total": 100,
    "page": 1,
    "size": 20,
    "pages": 5,
    "items": [
      {
        "id": 1,
        "category_id": 1,
        "category_name": "男装",
        "name": "男士T恤",
        "cover": "https://...",
        "price": 99.00,
        "stock": 100,
        "sales": 500,
        "status": 1,
        "is_hot": 1,
        "is_new": 0,
        "created_at": "2024-01-01 10:00:00"
      }
    ]
  }
}
```

---

### 3.2 创建商品

创建新商品。

**接口**: `POST /api/admin/products`

**认证**: 需要登录（管理员 Token）

**请求参数**:

```json
{
  "category_id": 1,
  "name": "男士T恤",
  "subtitle": "纯棉舒适，夏季必备",
  "cover": "https://...",
  "images": [
    "https://...",
    "https://..."
  ],
  "description": "<p>商品详细描述...</p>",
  "price": 99.00,
  "original_price": 199.00,
  "stock": 100,
  "is_hot": true,
  "is_new": false,
  "sort": 1,
  "skus": [
    {
      "sku_code": "SPU001-S001",
      "specs": {
        "颜色": "白色",
        "尺码": "L"
      },
      "price": 99.00,
      "stock": 50
    }
  ]
}
```

**响应示例**:

```json
{
  "code": 0,
  "message": "创建成功",
  "data": {
    "id": 100,
    "name": "男士T恤"
  }
}
```

---

### 3.3 更新商品

更新指定商品。

**接口**: `PUT /api/admin/products/{id}`

**认证**: 需要登录（管理员 Token）

**路径参数**: 商品 ID

**请求参数**: 同创建商品

**响应示例**:

```json
{
  "code": 0,
  "message": "更新成功"
}
```

---

### 3.4 删除商品

删除指定商品（软删除）。

**接口**: `DELETE /api/admin/products/{id}`

**认证**: 需要登录（管理员 Token）

**路径参数**: 商品 ID

**响应示例**:

```json
{
  "code": 0,
  "message": "删除成功"
}
```

---

## 四、订单管理模块

### 4.1 获取订单列表

获取订单列表，支持筛选和分页。

**接口**: `GET /api/admin/orders`

**认证**: 需要登录（管理员 Token）

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | integer | 否 | 页码，默认 1 |
| size | integer | 否 | 每页数量，默认 20 |
| status | integer | 否 | 订单状态 |
| keyword | string | 否 | 订单号/用户名 |
| start_date | string | 否 | 开始日期 |
| end_date | string | 否 | 结束日期 |

**响应示例**:

```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "total": 50,
    "page": 1,
    "size": 20,
    "pages": 3,
    "items": [
      {
        "id": 1001,
        "order_no": "202401201234560001",
        "user_id": 1,
        "nickname": "张三",
        "status": 1,
        "total_amount": 297.00,
        "pay_amount": 297.00,
        "pay_time": "2024-01-20 10:05:00",
        "created_at": "2024-01-20 10:00:00"
      }
    ]
  }
}
```

---

### 4.2 获取订单详情

获取指定订单的详细信息。

**接口**: `GET /api/admin/orders/{id}`

**认证**: 需要登录（管理员 Token）

**路径参数**: 订单 ID

**响应示例**:

```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "id": 1001,
    "order_no": "202401201234560001",
    "user": {
      "id": 1,
      "nickname": "张三",
      "phone": "13800138000"
    },
    "address": {
      "name": "张三",
      "phone": "13800138000",
      "province": "广东省",
      "city": "深圳市",
      "district": "南山区",
      "detail": "科技园123号"
    },
    "items": [
      {
        "product_name": "男士T恤",
        "product_image": "https://...",
        "specs": "白色/L",
        "price": 99.00,
        "quantity": 2
      }
    ],
    "status": 1,
    "total_amount": 297.00,
    "pay_amount": 297.00,
    "pay_time": "2024-01-20 10:05:00",
    "ship_time": null,
    "logistics": {
      "company": "顺丰快递",
      "tracking_no": "SF1234567890"
    }
  }
}
```

---

### 4.3 订单发货

为订单进行发货操作。

**接口**: `POST /api/admin/orders/{id}/ship`

**认证**: 需要登录（管理员 Token）

**路径参数**: 订单 ID

**请求参数**:

```json
{
  "company": "顺丰快递",
  "tracking_no": "SF1234567890"
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| company | string | 是 | 物流公司 |
| tracking_no | string | 是 | 物流单号 |

**响应示例**:

```json
{
  "code": 0,
  "message": "发货成功"
}
```

---

## 五、用户管理模块

### 5.1 获取用户列表

获取用户列表，支持筛选和分页。

**接口**: `GET /api/admin/users`

**认证**: 需要登录（管理员 Token）

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | integer | 否 | 页码，默认 1 |
| size | integer | 否 | 每页数量，默认 20 |
| keyword | string | 否 | 搜索关键词 |
| status | integer | 否 | 状态：0全部 1正常 2禁用 |

**响应示例**:

```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "total": 100,
    "page": 1,
    "size": 20,
    "pages": 5,
    "items": [
      {
        "id": 1,
        "openid": "oABC123...",
        "nickname": "张三",
        "avatar": "https://...",
        "phone": "13800138000",
        "balance": 100.50,
        "points": 500,
        "status": 1,
        "created_at": "2024-01-01 10:00:00",
        "order_count": 5,
        "total_amount": 500.00
      }
    ]
  }
}
```

---

### 5.2 更新用户状态

启用或禁用用户。

**接口**: `PUT /api/admin/users/{id}/status`

**认证**: 需要登录（管理员 Token）

**路径参数**: 用户 ID

**请求参数**:

```json
{
  "status": 0
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| status | integer | 是 | 状态：0禁用 1正常 |

**响应示例**:

```json
{
  "code": 0,
  "message": "更新成功"
}
```

---

## 六、营销管理模块

### 6.1 获取优惠券列表

获取优惠券模板列表。

**接口**: `GET /api/admin/coupons`

**认证**: 需要登录（管理员 Token）

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | integer | 否 | 页码，默认 1 |
| size | integer | 否 | 每页数量，默认 20 |
| status | integer | 否 | 状态：0全部 1启用 2禁用 |

**响应示例**:

```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "total": 10,
    "items": [
      {
        "id": 1,
        "name": "满100减20优惠券",
        "type": 1,
        "value": 20.00,
        "min_amount": 100.00,
        "total_count": 1000,
        "remain_count": 800,
        "per_limit": 1,
        "start_time": "2024-01-01 00:00:00",
        "end_time": "2024-12-31 23:59:59",
        "status": 1,
        "received_count": 200
      }
    ]
  }
}
```

---

### 6.2 创建优惠券

创建新的优惠券模板。

**接口**: `POST /api/admin/coupons`

**认证**: 需要登录（管理员 Token）

**请求参数**:

```json
{
  "name": "满100减20优惠券",
  "type": 1,
  "value": 20.00,
  "min_amount": 100.00,
  "total_count": 1000,
  "per_limit": 1,
  "start_time": "2024-01-01 00:00:00",
  "end_time": "2024-12-31 23:59:59",
  "status": 1
}
```

**响应示例**:

```json
{
  "code": 0,
  "message": "创建成功",
  "data": {
    "id": 10
  }
}
```

---

## 七、数据统计模块

### 7.1 数据概览

获取后台管理首页数据概览。

**接口**: `GET /api/admin/statistics/overview`

**认证**: 需要登录（管理员 Token）

**响应示例**:

```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "today": {
      "order_count": 50,
      "order_amount": 5000.00,
      "user_count": 10,
      "product_views": 1000
    },
    "total": {
      "order_count": 1000,
      "order_amount": 100000.00,
      "user_count": 500,
      "product_count": 100
    },
    "pending_orders": 10,
    "pending_shipments": 20
  }
}
```

---

### 7.2 销售统计

获取销售数据统计，支持按天/月统计。

**接口**: `GET /api/admin/statistics/sales`

**认证**: 需要登录（管理员 Token）

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| type | string | 否 | 统计类型：day按天 month按月，默认 day |
| start_date | string | 否 | 开始日期 |
| end_date | string | 否 | 结束日期 |

**响应示例**:

```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "dates": ["2024-01-15", "2024-01-16", "2024-01-17"],
    "order_counts": [50, 60, 70],
    "order_amounts": [5000.00, 6000.00, 7000.00],
    "total_order_count": 180,
    "total_order_amount": 18000.00
  }
}
```

---

## 八、系统配置模块

### 8.1 获取轮播图列表

获取轮播图列表。

**接口**: `GET /api/admin/banners`

**认证**: 需要登录（管理员 Token）

**响应示例**:

```json
{
  "code": 0,
  "message": "获取成功",
  "data": [
    {
      "id": 1,
      "title": "新年大促",
      "image": "https://...",
      "link_type": 1,
      "link_value": "1",
      "sort": 1,
      "status": 1
    }
  ]
}
```

---

### 8.2 创建轮播图

创建新的轮播图。

**接口**: `POST /api/admin/banners`

**认证**: 需要登录（管理员 Token）

**请求参数**:

```json
{
  "title": "新年大促",
  "image": "https://...",
  "link_type": 1,
  "link_value": "1",
  "sort": 1,
  "status": 1
}
```

**响应示例**:

```json
{
  "code": 0,
  "message": "创建成功",
  "data": {
    "id": 10
  }
}
```

---

## 九、文件上传

### 9.1 上传图片

上传图片到 OSS。

**接口**: `POST /api/admin/upload`

**认证**: 需要登录（管理员 Token）

**请求方式**: multipart/form-data

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| file | file | 是 | 图片文件 |

**响应示例**:

```json
{
  "code": 0,
  "message": "上传成功",
  "data": {
    "url": "https://oss.example.com/path/to/image.jpg"
  }
}
```

---

## 十、错误码说明

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

---

## 十一、调试示例

### 使用 cURL

```bash
# 管理员登录
curl -X POST "http://localhost:8000/api/admin/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'

# 获取商品列表
curl -X GET "http://localhost:8000/api/admin/products?page=1&size=20" \
  -H "Authorization: Bearer <token>"

# 订单发货
curl -X POST "http://localhost:8000/api/admin/orders/1001/ship" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "company": "顺丰快递",
    "tracking_no": "SF1234567890"
  }'

# 获取数据概览
curl -X GET "http://localhost:8000/api/admin/statistics/overview" \
  -H "Authorization: Bearer <token>"
```

---

## 十二、前端对接建议

### Axios 封装
```typescript
// src/utils/request.ts
import axios from 'axios'
import { ElMessage } from 'element-plus'

const request = axios.create({
  baseURL: '/api',
  timeout: 10000
})

request.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('admin_token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  }
)

request.interceptors.response.use(
  (response) => {
    const { code, message, data } = response.data
    if (code === 0) {
      return data
    } else {
      ElMessage.error(message)
      return Promise.reject(new Error(message))
    }
  },
  (error) => {
    ElMessage.error(error.message)
    return Promise.reject(error)
  }
)

export default request
```

### 登录
```typescript
import request from '@/utils/request'

interface LoginForm {
  username: string
  password: string
}

interface LoginResponse {
  token: string
  admin: Admin
}

export function login(data: LoginForm) {
  return request.post<LoginResponse>('/admin/login', data)
}
```

### 获取商品列表
```typescript
export function getProducts(params: any) {
  return request.get('/admin/products', { params })
}
```

### 订单发货
```typescript
export function shipOrder(id: number, data: any) {
  return request.post(`/admin/orders/${id}/ship`, data)
}
```
